---
layout: post
title: Going (Slightly) Beyond the Roo Examples
date: '2010-08-28T08:12:00.000-07:00'
author: Mark Corkery
tags:
- Programming
- MVC
- MySql
- Hibernate
- Roo
- Spring
modified_time: '2013-10-20T14:22:34.724-07:00'
blogger_id: tag:blogger.com,1999:blog-7218688161043116845.post-8069814806942881201
blogger_orig_url: http://markcorkery.blogspot.com/2010/08/going-slightly-beyond-roo-examples.html
---

<p>I've recently used <a title="Spring Roo" href="http://www.springsource.org/roo" target="_blank">Spring Roo</a> on a project to write a quick web front end for a demo I was producing. I have to confess that I didn't have much exposure to <a title="Spring" href="http://www.springsource.com/developer/spring" target="_blank">Spring</a>, <a title="Spring MVC" href="http://static.springsource.org/spring/docs/3.0.x/spring-framework-reference/html/mvc.html" target="_blank">Spring MVC</a> or <a title="Hibernate" href="http://www.hibernate.org/" target="_blank">Hibernate</a> prior to embarking on the project, but after reading the through the Roo website, I was convinced it would give me the head start I needed to meet a project deadline.</p><br/><br/><p>The version of Roo I used was 1.0.2.Release along with version 2.3.2 of <a href="http://www.springsource.com/products/eclipse-downloads">Spring STS</a>, the Eclipse based editor.</p><br/><br/><p>What I'm going to present here is an example based on the original <a title="tutorial" href="http://blog.springsource.com/2009/05/27/roo-part-2/" target="_blank">wedding tutorial</a> produced by Ben Alex as well as the work that I developed for the web demo. Hopefully, this blog will provide me with some feedback and maybe inspire a few other developers to share their thoughts too.</p><br/><br/><p>For this example, our domain is going to be very basic. We'll have a Support Manager who will have team of employees who have to indicate if they will be contactable outside of their normal working shift (as if that would ever happen, right?)</p><br/><a name='more'></a><br/><h2>Creating a basic Web Project with Roo</h2><br/><p>To create a new Roo based project within STS, simply click File -&gt; New -&gt; Other and on the dialog that is launched expand SpringSource Tool Suite and select 'Roo Project'.</p><br/><br/>Enter the name of the project and the top level package, e.g. com.kramkroc.example<br/><br/>STS/Roo will now have created a Maven 2 project structure within your workspace and will have launched the Roo shell too. Within the shell, we'll set up the persistence that we'll use within the project. I'm just going to go with hypersonic in memory for this example but you can choose from a range of different providers/types (hint: type persistence and then Ctrl + Space and the shell will prompt you with a list of completions for the command)<br/><br/>[sourcecode wraplines="false" light="true"]<br/>roo&gt; persistence setup --database HYPERSONIC_IN_MEMORY --provider HIBERNATE<br/><br/>[/sourcecode]<br/><h4>Creating Your Entities</h4><br/>Let's create an abstract class that will hold common data (such as the first name, last name and telephone fields) for the manager and the team.<br/><br/>[sourcecode wraplines="false" light="true"]<br/>roo&gt; entity --class ~.domain.AbstractPerson --abstract<br/>~.domain.AbstractPerson roo&gt; field string --fieldName firstName  --notNull --sizeMin 3 --sizeMax 30<br/>~.domain.AbstractPerson roo&gt; field string --fieldName lastName --notNull --sizeMin 3 --sizeMax 30<br/>~.domain.AbstractPerson roo&gt; field string --fieldName telephone --notNull  --sizeMin 4<br/>[/sourcecode]<br/><br/>As mentioned above, the team members may be expected to perform some out of hours support, so lets create a simple enumeration to represent the various options:<br/><br/>[sourcecode wraplines="false" light="true"]<br/>~.domain.TeamMember roo&gt; enum type --class ~.reference.OutOfHoursSupport<br/>~.reference.OutOfHoursSupport roo&gt; enum constant --name WeekendOnly<br/>~.reference.OutOfHoursSupport roo&gt; enum constant --name WeekdaysOnly<br/>~.reference.OutOfHoursSupport roo&gt; enum constant --name AllWeek<br/>~.reference.OutOfHoursSupport roo&gt; enum constant --name Never<br/>[/sourcecode]<br/><br/>Let's move to the Employee entity, which will extend the AbstractPerson class and add our field to indicate the type of out of hours support that will be provided:<br/><br/>[sourcecode wraplines="false" light="true"]<br/>~.domain.AbstractPerson roo&gt; entity --class ~.domain.TeamMember --extends ~.domain.AbstractPerson --testAutomatically<br/>~.domain.TeamMember roo&gt; field enum --fieldName supportHours --type ~.reference.OutOfHoursSupport --notNull<br/>[/sourcecode]<br/><br/>Including the --testAutomatically ensures that a number of integration tests have been created which can be used to test this new entity. To kick off the test, issue this command:<br/><br/>[sourcecode wraplines="false" light="true"]<br/>~.domain.TeamMember roo&gt; perform tests<br/>[/sourcecode]<br/><br/>Now let's create the support manager and then create the relationship between the team member and their support manager:<br/><br/>[sourcecode wraplines="false" light="true"]<br/>~.domain.TeamMember roo&gt; entity --class ~.domain.SupportManager --extends ~.domain.AbstractPerson --testAutomatically<br/>~.domain.SupportManager roo&gt; field reference --fieldName supportManager --type ~.domain.SupportManager --class ~.domain.TeamMember<br/>[/sourcecode]<br/><br/>And finally let's create the other end of the relationship:<br/><br/>[sourcecode wraplines="false" light="true"]<br/>~.domain.TeamMember roo&gt; field set --class ~.domain.SupportManager --fieldName teamMembers --element ~.domain.TeamMember --mappedBy supportManager --notNull false --cardinality ONE_TO_MANY<br/>[/sourcecode]<br/><h4>Creating the basic Web Controllers</h4><br/>Creating the web controller couldn't be simpler:<br/><br/>[sourcecode wraplines="false" light="true"]<br/>~.domain.TeamMember roo&gt; controller all --package ~.web<br/>[/sourcecode]<br/><br/>Let's add spring security and logging:<br/><br/>[sourcecode wraplines="false" light="true"]<br/>~.web roo&gt; logging setup --level DEBUG<br/>~.web roo&gt; security setup<br/>[/sourcecode]<br/><br/>Nows a great time to take a look at what you've created. Launch an external terminal and navigate to your project directory (the one where your pom.xml for this project resides) and enter the following at the command prompt:<br/><br/>[sourcecode language="bash" wraplines="false" light="true"]<br/>~.workspace/com.kramkroc.example&gt; mvn tomcat:run<br/>[/sourcecode]<br/><br/>Launch your favorite browser and navigate to <strong>http://localhost:8080/com.kramkroc.example</strong> and you should see a page that looks like this:<br/><br/><a href="http://kramkroc.files.wordpress.com/2010/08/basicroowebapp.png"><img class="aligncenter size-full wp-image-32" title="Basic Roo Application" src="http://kramkroc.files.wordpress.com/2010/08/basicroowebapp.png" alt="" width="497" height="157" /></a><br/><br/>You'll probably notice that you were not prompted to login. A small change is needed to the security configuration section of <strong>src/main/resources/META-INF/spring/applicationContext-security.xml</strong> file. We'll update the views created for the support manager and team members to be only accessible by an admin user. The rest of the site should only be accessible if the user has been authenticated:<br/><br/>[sourcecode language="xml" wraplines="false"]<br/>	&lt;!-- HTTP security configurations --&gt;<br/>    &lt;http auto-config=&quot;true&quot; use-expressions=&quot;true&quot;&gt;<br/>    	&lt;form-login login-processing-url=&quot;/static/j_spring_security_check&quot; login-page=&quot;/login&quot; authentication-failure-url=&quot;/login?login_error=t&quot;/&gt;<br/>        &lt;logout logout-url=&quot;/static/j_spring_security_logout&quot;/&gt;<br/><br/>        &lt;!-- Configure these elements to secure URIs in your application --&gt;<br/>        &lt;intercept-url pattern=&quot;/supportmanager/**&quot; access=&quot;hasRole('ROLE_ADMIN')&quot;/&gt;<br/>        &lt;intercept-url pattern=&quot;/teammember/**&quot; access=&quot;hasRole('ROLE_ADMIN')&quot;/&gt;<br/>        &lt;intercept-url pattern=&quot;/resources/**&quot; access=&quot;permitAll&quot; /&gt;<br/>        &lt;intercept-url pattern=&quot;/static/**&quot; access=&quot;permitAll&quot; /&gt;<br/>        &lt;intercept-url pattern=&quot;/login/**&quot; access=&quot;permitAll&quot; /&gt;<br/>        &lt;intercept-url pattern=&quot;/**&quot; access=&quot;isAuthenticated()&quot; /&gt;<br/>    &lt;/http&gt;<br/>[/sourcecode]<br/><h2>(Slightly) Extending the application</h2><br/>Wow, so Roo has really packed in an awful lot in just a few commands and a small bit of xml editing. The pages created are pretty basic, but I like them as they provide what I think of as an administrators entry point to the underlying system with access to all team members and support managers.<br/><br/>For the project I was working on, I wanted to allow a single user to log in and view their specific details, so how hard is it to get to that stage? Well, not hard at all.<br/><br/>The first thing I did was add two finders into my domain model. One to find a specific support manager by their telephone number, and another to find all team members by their support manager. Roo provides a straight forward method to accomplish this. First you list all finders for a specified entity and then add the finder you want to the entity:<br/><br/>[sourcecode wraplines="false" highlight="1,8"]<br/>roo&gt; finder list --class ~.domain.SupportManager --filter tele<br/>findSupportManagersByTelephone(String telephone)<br/>findSupportManagersByTelephoneEquals(String telephone)<br/>findSupportManagersByTelephoneIsNotNull()<br/>findSupportManagersByTelephoneIsNull()<br/>findSupportManagersByTelephoneLike(String telephone)<br/>findSupportManagersByTelephoneNotEquals(String telephone)<br/>~.domain.SupportManager roo&gt; finder add --finderName findSupportManagersByTelephoneEquals<br/>[/sourcecode]<br/><br/>The --filter option provides an easy to user filtering method for the result set of finders displayed. We'll do the same for the team member entity:<br/><br/>[sourcecode wraplines="false" highlight="1,4"]<br/>~.domain.SupportManager roo&gt; finder list --class ~.domain.TeamMember --filter support<br/>findTeamMembersBySupportHours(OutOfHoursSupport supportHours)<br/>findTeamMembersBySupportManager(SupportManager supportManager)<br/>~.domain.TeamMember roo&gt; finder add --finderName findTeamMembersBySupportManager<br/>[/sourcecode]<br/><br/>Now that we can find specific entities we should create our specific views. To do this, simply create a public version of the support manager and team member views (as hinted at earlier, I think of the previous views created for the entities as being an administrators access point to the underlying data).<br/><br/>[sourcecode wraplines="false" light="true"]<br/>roo&gt; controller scaffold --class ~.web.PublicTeamMemberController --entity ~.domain.TeamMember<br/>roo&gt; controller scaffold --class ~.web.PublicSupportManagerController --entity ~.domain.SupportManager<br/>[/sourcecode]<br/><br/>These commands will create the public controllers for the new views, and to get Roo to create the actual views, just update the @RooWebScaffold and @RequestMapping annotated fields of your new controllers to be the public versions. For example, swap supportmanager for publicsupportmanager as shown below:<br/><br/>[sourcecode language="java" wraplines="false" highlight="8,9"]<br/>package com.kramkroc.example.web;<br/><br/>import org.springframework.roo.addon.web.mvc.controller.RooWebScaffold;<br/>import com.kramkroc.example.domain.SupportManager;<br/>import org.springframework.web.bind.annotation.RequestMapping;<br/>import org.springframework.stereotype.Controller;<br/><br/>@RooWebScaffold(path = &quot;publicsupportmanager&quot;, automaticallyMaintainView = true, formBackingObject = SupportManager.class)<br/>@RequestMapping(&quot;/publicsupportmanager/**&quot;)<br/>@Controller<br/>public class PublicSupportManagerController {<br/>}<br/>[/sourcecode]</pre><br/>If you check your <strong>src/main/webapp/WEB-INF/views</strong> folder now you should see two new folders which contain the jspx files for your new public views.<br/><br/>What we need to do now is modify the public controllers to pull in the specific details of the logged in user based on their telephone number. we begin by adding a couple of "users" to the <strong>src/main/resources/META-INF/spring/applicationContext-security.xml</strong> file.<br/><br/>[sourcecode language="xml" wraplines="false" highlight="10,12"]<br/>&lt;!-- Configure Authentication mechanism --&gt;<br/>    &lt;authentication-manager alias=&quot;authenticationManager&quot;&gt;<br/>    	&lt;!-- SHA-256 values can be produced using 'echo -n your_desired_password | sha256sum' (using normal *nix environments) --&gt;<br/>    	&lt;authentication-provider&gt;<br/>	    	&lt;password-encoder hash=&quot;sha-256&quot;/&gt;<br/>	        &lt;user-service&gt;<br/>	            &lt;user name=&quot;admin&quot; password=&quot;8c6976e5b5410415bde908bd4dee15dfb167a9c873fc4bb8a81f6f2ab448a918&quot; authorities=&quot;ROLE_ADMIN&quot;/&gt;<br/>		        &lt;user name=&quot;user&quot; password=&quot;04f8996da763b7a969b1028ee3007569eaf3a635486ddab211d512c85b9df8fb&quot; authorities=&quot;ROLE_USER&quot;/&gt;<br/>		    &lt;/user-service&gt;<br/>                        &lt;user name=&quot;1201&quot; password=&quot;04f8996da763b7a969b1028ee3007569eaf3a635486ddab211d512c85b9df8fb&quot; authorities=&quot;ROLE_USER&quot;/&gt;<br/>		    &lt;/user-service&gt;<br/>                        &lt;user name=&quot;1202&quot; password=&quot;04f8996da763b7a969b1028ee3007569eaf3a635486ddab211d512c85b9df8fb&quot; authorities=&quot;ROLE_USER&quot;/&gt;<br/>		    &lt;/user-service&gt;<br/>    	&lt;/authentication-provider&gt;<br/>	&lt;/authentication-manager&gt;<br/>[/sourcecode]</pre><br/>Next we use the refactoring tool within Eclipse/STS to "Push-In" the generated aspect code for the public web controllers back into the public controllers themselves. To do this select the View Menu -&gt; Filters and uncheck the "Hide generated Spring Roo ITDs" and then right click of the file ending with the name _Roo_Controller.aj that matches your public controller and select Refactor -&gt; Push In... and press the OK button. Make sure you repeat this for both of the public controllers. The first thing you should then do is comment out or delete the line with the @RooWebScaffold annotation otherwise you'll find that some of the modifications that are coming up will be automatically replaced/written by the Roo shell.<br/><br/>Let's add a simple method to find the support manager based on authentication details of the logged in user and remove some of the methods that we will not be using (e.g. the find methods, but I've highlighted some of the other changes that were made):<br/><br/>[sourcecode language="java" wraplines="false" highlight="28,37,38,39,40,41,42,52,62,63,64,65,66,67,68,69,70,71,72"]<br/>package com.kramkroc.example.web;<br/><br/>import javax.validation.Valid;<br/><br/>import org.springframework.dao.DataAccessException;<br/>import org.springframework.security.core.context.SecurityContextHolder;<br/>import org.springframework.stereotype.Controller;<br/>import org.springframework.ui.ModelMap;<br/>import org.springframework.validation.BindingResult;<br/>import org.springframework.web.bind.annotation.PathVariable;<br/>import org.springframework.web.bind.annotation.RequestMapping;<br/>import org.springframework.web.bind.annotation.RequestMethod;<br/><br/>import com.kramkroc.example.domain.SupportManager;<br/><br/>@RequestMapping(&quot;/publicsupportmanager/**&quot;)<br/>@Controller<br/>public class PublicSupportManagerController {<br/><br/>	@RequestMapping(value = &quot;/publicsupportmanager&quot;, method = RequestMethod.POST)<br/>    public String create(@Valid SupportManager supportManager, BindingResult result, ModelMap modelMap) {<br/>        if (supportManager == null) throw new IllegalArgumentException(&quot;A supportManager is required&quot;);<br/>        if (result.hasErrors()) {<br/>            modelMap.addAttribute(&quot;supportManager&quot;, supportManager);<br/>            return &quot;publicsupportmanager/create&quot;;<br/>        }<br/>        supportManager.persist();<br/>        return &quot;redirect:/publicsupportmanager&quot;;<br/>    }<br/><br/>	@RequestMapping(value = &quot;/publicsupportmanager/form&quot;, method = RequestMethod.GET)<br/>    public String createForm(ModelMap modelMap) {<br/>        modelMap.addAttribute(&quot;supportManager&quot;, new SupportManager());<br/>        return &quot;publicsupportmanager/create&quot;;<br/>    }<br/><br/>	@RequestMapping(value = &quot;/publicsupportmanager&quot;, method = RequestMethod.GET)<br/>    public String show(ModelMap modelMap) {<br/>		SupportManager supportManager = (SupportManager) getSupportManager();<br/>		modelMap.addAttribute(&quot;supportManager&quot;, supportManager);<br/>        return &quot;publicsupportmanager/show&quot;;<br/>    }<br/><br/>	@RequestMapping(method = RequestMethod.PUT)<br/>    public String update(@Valid SupportManager supportManager, BindingResult result, ModelMap modelMap) {<br/>        if (supportManager == null) throw new IllegalArgumentException(&quot;A supportManager is required&quot;);<br/>        if (result.hasErrors()) {<br/>            modelMap.addAttribute(&quot;supportManager&quot;, supportManager);<br/>            return &quot;publicsupportmanager/update&quot;;<br/>        }<br/>        supportManager.merge();<br/>        return &quot;redirect:/publicsupportmanager/&quot;;<br/>    }<br/><br/>	@RequestMapping(value = &quot;/publicsupportmanager/{id}/form&quot;, method = RequestMethod.GET)<br/>    public String updateForm(@PathVariable(&quot;id&quot;) Long id, ModelMap modelMap) {<br/>        if (id == null) throw new IllegalArgumentException(&quot;An Identifier is required&quot;);<br/>        modelMap.addAttribute(&quot;supportManager&quot;, SupportManager.findSupportManager(id));<br/>        return &quot;publicsupportmanager/update&quot;;<br/>    }<br/><br/>	private Object getSupportManager() {<br/>		SupportManager supportManager = new SupportManager();<br/>		try {<br/>			String telephoneNumber = SecurityContextHolder.getContext().getAuthentication().getName();<br/>			supportManager.setTelephone(telephoneNumber);<br/>			supportManager = (SupportManager) SupportManager.findSupportManagersByTelephoneEquals(telephoneNumber).getSingleResult();<br/>		} catch (DataAccessException ignored) { /* if no support manager was found, return the new one */<br/>		}<br/><br/>		return supportManager;<br/>	}<br/>}<br/>[/sourcecode]</pre><br/>We can delete the list.jspx and findSupportManagerByTelephoneEqausl.jspx from the <strong>src/main/webapp/WEB-INF/views/publicsupportmanager</strong> directory and then edit the <strong>show.jspx</strong> to remove the div for teammembers and replace it with an update button:<br/><br/>[sourcecode language="html" wraplines="false" highlight="30,31,32,33,34,35,36,37,38"]<br/>&lt;div xmlns:c=&quot;http://java.sun.com/jsp/jstl/core&quot; xmlns:fmt=&quot;http://java.sun.com/jsp/jstl/fmt&quot; xmlns:form=&quot;http://www.springframework.org/tags/form&quot; xmlns:jsp=&quot;http://java.sun.com/JSP/Page&quot; xmlns:spring=&quot;http://www.springframework.org/tags&quot; version=&quot;2.0&quot;&gt;<br/>    &lt;jsp:output omit-xml-declaration=&quot;yes&quot;/&gt;<br/>    &lt;script type=&quot;text/javascript&quot;&gt;dojo.require('dijit.TitlePane');&lt;/script&gt;<br/>    &lt;div id=&quot;_title_div&quot;&gt;<br/>        &lt;spring:message code=&quot;label.supportmanager&quot; var=&quot;entity_label&quot;/&gt;<br/>        &lt;spring:message arguments=&quot;${entity_label}&quot; code=&quot;entity.show&quot; var=&quot;title_msg&quot;/&gt;<br/>        &lt;script type=&quot;text/javascript&quot;&gt;Spring.addDecoration(new Spring.ElementDecoration({elementId : '_title_div', widgetType : 'dijit.TitlePane', widgetAttrs : {title: '${title_msg}'}})); &lt;/script&gt;<br/>        &lt;c:if test=&quot;${not empty supportManager}&quot;&gt;<br/>            &lt;div id=&quot;roo_supportManager_firstName&quot;&gt;<br/>                &lt;label for=&quot;_firstName_id&quot;&gt;First Name:&lt;/label&gt;<br/>                &lt;div class=&quot;box&quot; id=&quot;_firstName_id&quot;&gt;<br/>                    &lt;c:out value=&quot;${supportManager.firstName}&quot;/&gt;<br/>                &lt;/div&gt;<br/>            &lt;/div&gt;<br/>            &lt;br/&gt;<br/>            &lt;div id=&quot;roo_supportManager_lastName&quot;&gt;<br/>                &lt;label for=&quot;_lastName_id&quot;&gt;Last Name:&lt;/label&gt;<br/>                &lt;div class=&quot;box&quot; id=&quot;_lastName_id&quot;&gt;<br/>                    &lt;c:out value=&quot;${supportManager.lastName}&quot;/&gt;<br/>                &lt;/div&gt;<br/>            &lt;/div&gt;<br/>            &lt;br/&gt;<br/>            &lt;div id=&quot;roo_supportManager_telephone&quot;&gt;<br/>                &lt;label for=&quot;_telephone_id&quot;&gt;Telephone:&lt;/label&gt;<br/>                &lt;div class=&quot;box&quot; id=&quot;_telephone_id&quot;&gt;<br/>                    &lt;c:out value=&quot;${supportManager.telephone}&quot;/&gt;<br/>                &lt;/div&gt;<br/>            &lt;/div&gt;<br/>            &lt;br/&gt;<br/>			&lt;div class=&quot;submit&quot; id=&quot;roo_supportManager_submit&quot;&gt;<br/>                &lt;spring:url value=&quot;/publicsupportmanager/${supportManager.id}/form&quot; var=&quot;update_form_url&quot;/&gt;<br/>                &lt;form:form action=&quot;${update_form_url}&quot; method=&quot;GET&quot;&gt;<br/>                    &lt;spring:message code=&quot;button.update&quot; var=&quot;update_button&quot;/&gt;<br/>                    &lt;script type=&quot;text/javascript&quot;&gt;Spring.addDecoration(new Spring.ValidateAllDecoration({elementId:'proceed', event:'onclick'}));&lt;/script&gt;<br/>                    &lt;input id=&quot;proceed&quot; type=&quot;submit&quot; value=&quot;${update_button}&quot;/&gt;<br/>                &lt;/form:form&gt;<br/>            &lt;/div&gt;<br/>            &lt;br/&gt;<br/>        &lt;/c:if&gt;<br/>        &lt;c:if test=&quot;${empty supportManager}&quot;&gt;<br/>            &lt;spring:message arguments=&quot;${entity_label}&quot; code=&quot;entity.not.found.single&quot;/&gt;<br/>        &lt;/c:if&gt;<br/>    &lt;/div&gt;<br/>&lt;/div&gt;<br/>[/sourcecode]</pre><br/>Similar changes need to be made to the public controller for the team member object. One difference of course, is that here we must set the support manager attribute when performing an update or create to be that of the currently logged in support manager:<br/><br/>[sourcecode language="java" wraplines="false" highlight="31,50,51,52,53,54,64,84,85,86,87,88,89,90,91,92,93,94"]<br/>package com.kramkroc.example.web;<br/><br/>import javax.validation.Valid;<br/><br/>import org.springframework.dao.DataAccessException;<br/>import org.springframework.security.core.context.SecurityContextHolder;<br/>import org.springframework.stereotype.Controller;<br/>import org.springframework.ui.ModelMap;<br/>import org.springframework.validation.BindingResult;<br/>import org.springframework.web.bind.annotation.PathVariable;<br/>import org.springframework.web.bind.annotation.RequestMapping;<br/>import org.springframework.web.bind.annotation.RequestMethod;<br/>import org.springframework.web.bind.annotation.RequestParam;<br/><br/>import com.kramkroc.example.domain.SupportManager;<br/>import com.kramkroc.example.domain.TeamMember;<br/>import com.kramkroc.example.reference.OutOfHoursSupport;<br/><br/>@RequestMapping(&quot;/publicteammember/**&quot;)<br/>@Controller<br/>public class PublicTeamMemberController {<br/><br/>	@RequestMapping(value = &quot;/publicteammember&quot;, method = RequestMethod.POST)<br/>    public String create(@Valid TeamMember teamMember, BindingResult result, ModelMap modelMap) {<br/>        if (teamMember == null) throw new IllegalArgumentException(&quot;A teamMember is required&quot;);<br/>        if (result.hasErrors()) {<br/>            modelMap.addAttribute(&quot;teamMember&quot;, teamMember);<br/>            modelMap.addAttribute(&quot;outofhourssupport_enum&quot;, OutOfHoursSupport.class.getEnumConstants());<br/>            return &quot;publicteammember/create&quot;;<br/>        }<br/>        teamMember.setSupportManager((SupportManager) getSupportManager());<br/>        teamMember.persist();<br/>        return &quot;redirect:/publicteammember/&quot; + teamMember.getId();<br/>    }<br/><br/>	@RequestMapping(value = &quot;/publicteammember/form&quot;, method = RequestMethod.GET)<br/>    public String createForm(ModelMap modelMap) {<br/>        modelMap.addAttribute(&quot;teamMember&quot;, new TeamMember());<br/>        modelMap.addAttribute(&quot;outofhourssupport_enum&quot;, OutOfHoursSupport.class.getEnumConstants());<br/>        return &quot;publicteammember/create&quot;;<br/>    }<br/><br/>	@RequestMapping(value = &quot;/publicteammember/{id}&quot;, method = RequestMethod.GET)<br/>    public String show(@PathVariable(&quot;id&quot;) Long id, ModelMap modelMap) {<br/>        if (id == null) throw new IllegalArgumentException(&quot;An Identifier is required&quot;);<br/>        modelMap.addAttribute(&quot;teamMember&quot;, TeamMember.findTeamMember(id));<br/>        return &quot;publicteammember/show&quot;;<br/>    }<br/><br/>	@RequestMapping(value = &quot;/publicteammember&quot;, method = RequestMethod.GET)<br/>    public String list(@RequestParam(value = &quot;page&quot;, required = false) Integer page, @RequestParam(value = &quot;size&quot;, required = false) Integer size, ModelMap modelMap) {<br/>        modelMap.addAttribute(&quot;teammembers&quot;, TeamMember.findTeamMembersBySupportManager((SupportManager) getSupportManager()).getResultList())<br/>        return &quot;publicteammember/list&quot;;<br/>    }<br/><br/>	@RequestMapping(method = RequestMethod.PUT)<br/>    public String update(@Valid TeamMember teamMember, BindingResult result, ModelMap modelMap) {<br/>        if (teamMember == null) throw new IllegalArgumentException(&quot;A teamMember is required&quot;);<br/>        if (result.hasErrors()) {<br/>            modelMap.addAttribute(&quot;teamMember&quot;, teamMember);<br/>            modelMap.addAttribute(&quot;outofhourssupport_enum&quot;, OutOfHoursSupport.class.getEnumConstants());<br/>            return &quot;publicteammember/update&quot;;<br/>        }<br/>        teamMember.setSupportManager((SupportManager) getSupportManager());<br/>        teamMember.merge();<br/>        return &quot;redirect:/publicteammember/&quot; + teamMember.getId();<br/>    }<br/><br/>	@RequestMapping(value = &quot;/publicteammember/{id}/form&quot;, method = RequestMethod.GET)<br/>    public String updateForm(@PathVariable(&quot;id&quot;) Long id, ModelMap modelMap) {<br/>        if (id == null) throw new IllegalArgumentException(&quot;An Identifier is required&quot;);<br/>        modelMap.addAttribute(&quot;teamMember&quot;, TeamMember.findTeamMember(id));<br/>        modelMap.addAttribute(&quot;outofhourssupport_enum&quot;, OutOfHoursSupport.class.getEnumConstants());<br/>        return &quot;publicteammember/update&quot;;<br/>    }<br/><br/>	@RequestMapping(value = &quot;/publicteammember/{id}&quot;, method = RequestMethod.DELETE)<br/>    public String delete(@PathVariable(&quot;id&quot;) Long id, @RequestParam(value = &quot;page&quot;, required = false) Integer page, @RequestParam(value = &quot;size&quot;, required = false) Integer size) {<br/>        if (id == null) throw new IllegalArgumentException(&quot;An Identifier is required&quot;);<br/>        TeamMember.findTeamMember(id).remove();<br/>        return &quot;redirect:/publicteammember?page=&quot; + ((page == null) ? &quot;1&quot; : page.toString()) + &quot;&amp;size=&quot; + ((size == null) ? &quot;10&quot; : size.toString());<br/>    }<br/><br/>	private Object getSupportManager() {<br/>		SupportManager supportManager = new SupportManager();<br/>		try {<br/>			String telephoneNumber = SecurityContextHolder.getContext().getAuthentication().getName();<br/>			supportManager.setTelephone(telephoneNumber);<br/>			supportManager = (SupportManager) SupportManager.findSupportManagersByTelephoneEquals(telephoneNumber).getSingleResult();<br/>		} catch (DataAccessException ignored) { /* if no support manager was found, return the new one */<br/>		}<br/><br/>		return supportManager;<br/>	}<br/>}<br/>[/sourcecode]</pre><br/>We can delete the findTeamMembersBySupportManager.jspx file from the src/main/webapp/WEB-INF/views/publicteammember directory and then edit the create, update and show.jspx to remove the divs for support manager.<br/><br/>The last couple of changes concern the <strong>src/main/webapp/WEB-INF/views/menu.jspx</strong>. As mentioned previously we want to keep the original menu items concerning the generic/admin links for administration users, but also tailor the links for the public users. Again this is straight forward. We'll use the spring security taglib to control what gets displayed based of the users authentication details. At the same time we'll change the menu items created for the public views so that for the Support Manager we'll only have a Show link instead fo the standard create and list menu items. The jspx looks like this after the updates are made:<br/><br/>[sourcecode language="xml" wraplines="false" highlight="1,4,61,62,68,69,70,71,72,73,74,99"]<br/>&lt;div xmlns:c=&quot;http://java.sun.com/jsp/jstl/core&quot; xmlns:jsp=&quot;http://java.sun.com/JSP/Page&quot; xmlns:security=&quot;http://www.springframework.org/security/tags&quot; xmlns:spring=&quot;http://www.springframework.org/tags&quot; id=&quot;menu&quot; version=&quot;2.0&quot;&gt;<br/>	&lt;jsp:output omit-xml-declaration=&quot;yes&quot;/&gt;<br/>	&lt;ul id=&quot;roo_menu&quot;&gt;<br/>    &lt;security:authorize ifAllGranted=&quot;ROLE_ADMIN&quot;&gt;<br/>	&lt;li id=&quot;web_mvc_jsp_teammember_category&quot;&gt;<br/>            &lt;h2&gt;<br/>                &lt;spring:message code=&quot;menu.category.web_mvc_jsp_teammember_category.label&quot;/&gt;<br/>            &lt;/h2&gt;<br/>            &lt;ul&gt;<br/>                &lt;li id=&quot;web_mvc_jsp_create_teammember_menu_item&quot;&gt;<br/>                    &lt;spring:url value=&quot;/teammember/form&quot; var=&quot;web_mvc_jsp_create_teammember_menu_item_url&quot;/&gt;<br/>                    &lt;a href=&quot;${web_mvc_jsp_create_teammember_menu_item_url}&quot;&gt;<br/>                        &lt;spring:message code=&quot;label.teammember&quot; var=&quot;label_teammember&quot;/&gt;<br/>                        &lt;spring:message arguments=&quot;${label_teammember}&quot; code=&quot;global.menu.new&quot;/&gt;<br/>                    &lt;/a&gt;<br/>                &lt;/li&gt;<br/>            &lt;li id=&quot;web_mvc_jsp_list_teammember_menu_item&quot;&gt;<br/>                    &lt;spring:url value=&quot;/teammember?page=${empty param.page ? 1 : param.page}&amp;amp;amp;size=${empty param.size ? 10 : param.size}&quot; var=&quot;web_mvc_jsp_list_teammember_menu_item_url&quot;/&gt;<br/>                    &lt;a href=&quot;${web_mvc_jsp_list_teammember_menu_item_url}&quot;&gt;<br/>                        &lt;spring:message code=&quot;label.teammembers&quot; var=&quot;label_teammembers&quot;/&gt;<br/>                        &lt;spring:message arguments=&quot;${label_teammembers}&quot; code=&quot;global.menu.list&quot;/&gt;<br/>                    &lt;/a&gt;<br/>                &lt;/li&gt;<br/>            &lt;li id=&quot;finder_findteammembersbysupportmanager_menu_item&quot;&gt;<br/>                    &lt;spring:url value=&quot;/teammember/find/BySupportManager/form&quot; var=&quot;finder_findteammembersbysupportmanager_menu_item_url&quot;/&gt;<br/>                    &lt;a href=&quot;${finder_findteammembersbysupportmanager_menu_item_url}&quot;&gt;<br/>                        &lt;spring:message code=&quot;label.supportmanager&quot; var=&quot;label_supportmanager&quot;/&gt;<br/>                        &lt;spring:message arguments=&quot;${label_supportmanager}&quot; code=&quot;global.menu.find&quot;/&gt;<br/>                    &lt;/a&gt;<br/>                &lt;/li&gt;<br/>            &lt;/ul&gt;<br/>        &lt;/li&gt;<br/>    &lt;li id=&quot;web_mvc_jsp_supportmanager_category&quot;&gt;<br/>            &lt;h2&gt;<br/>                &lt;spring:message code=&quot;menu.category.web_mvc_jsp_supportmanager_category.label&quot;/&gt;<br/>            &lt;/h2&gt;<br/>            &lt;ul&gt;<br/>                &lt;li id=&quot;web_mvc_jsp_create_supportmanager_menu_item&quot;&gt;<br/>                    &lt;spring:url value=&quot;/supportmanager/form&quot; var=&quot;web_mvc_jsp_create_supportmanager_menu_item_url&quot;/&gt;<br/>                    &lt;a href=&quot;${web_mvc_jsp_create_supportmanager_menu_item_url}&quot;&gt;<br/>                        &lt;spring:message code=&quot;label.supportmanager&quot; var=&quot;label_supportmanager&quot;/&gt;<br/>                        &lt;spring:message arguments=&quot;${label_supportmanager}&quot; code=&quot;global.menu.new&quot;/&gt;<br/>                    &lt;/a&gt;<br/>                &lt;/li&gt;<br/>            &lt;li id=&quot;web_mvc_jsp_list_supportmanager_menu_item&quot;&gt;<br/>                    &lt;spring:url value=&quot;/supportmanager?page=${empty param.page ? 1 : param.page}&amp;amp;amp;size=${empty param.size ? 10 : param.size}&quot; var=&quot;web_mvc_jsp_list_supportmanager_menu_item_url&quot;/&gt;<br/>                    &lt;a href=&quot;${web_mvc_jsp_list_supportmanager_menu_item_url}&quot;&gt;<br/>                        &lt;spring:message code=&quot;label.supportmanagers&quot; var=&quot;label_supportmanagers&quot;/&gt;<br/>                        &lt;spring:message arguments=&quot;${label_supportmanagers}&quot; code=&quot;global.menu.list&quot;/&gt;<br/>                    &lt;/a&gt;<br/>                &lt;/li&gt;<br/>            &lt;li id=&quot;finder_findsupportmanagersbytelephoneequals_menu_item&quot;&gt;<br/>                    &lt;spring:url value=&quot;/supportmanager/find/ByTelephoneEquals/form&quot; var=&quot;finder_findsupportmanagersbytelephoneequals_menu_item_url&quot;/&gt;<br/>                    &lt;a href=&quot;${finder_findsupportmanagersbytelephoneequals_menu_item_url}&quot;&gt;<br/>                        &lt;spring:message code=&quot;label.telephoneequals&quot; var=&quot;label_telephoneequals&quot;/&gt;<br/>                        &lt;spring:message arguments=&quot;${label_telephoneequals}&quot; code=&quot;global.menu.find&quot;/&gt;<br/>                    &lt;/a&gt;<br/>                &lt;/li&gt;<br/>            &lt;/ul&gt;<br/>        &lt;/li&gt;<br/>    &lt;/security:authorize&gt;<br/>    &lt;security:authorize ifNotGranted=&quot;ROLE_ADMIN&quot;&gt;<br/>    &lt;li id=&quot;web_mvc_jsp_publicsupportmanager_category&quot;&gt;<br/>            &lt;h2&gt;<br/>                &lt;spring:message code=&quot;menu.category.web_mvc_jsp_publicsupportmanager_category.label&quot;/&gt;<br/>            &lt;/h2&gt;<br/>            &lt;ul&gt;<br/>                &lt;li id=&quot;web_mvc_jsp_show_publicsupportmanager_menu_item&quot;&gt;<br/>                    &lt;spring:url value=&quot;/publicsupportmanager&quot; var=&quot;web_mvc_jsp_show_publicsupportmanager_menu_item_url&quot;/&gt;<br/>                    &lt;a href=&quot;${web_mvc_jsp_show_publicsupportmanager_menu_item_url}&quot;&gt;<br/>                        &lt;spring:message code=&quot;label.supportmanager&quot; var=&quot;label_supportmanager&quot;/&gt;<br/>                        &lt;spring:message arguments=&quot;${label_supportmanager}&quot; code=&quot;global.menu.show&quot;/&gt;<br/>                    &lt;/a&gt;<br/>                &lt;/li&gt;<br/>            &lt;/ul&gt;<br/>        &lt;/li&gt;<br/>    &lt;li id=&quot;web_mvc_jsp_publicteammember_category&quot;&gt;<br/>            &lt;h2&gt;<br/>                &lt;spring:message code=&quot;menu.category.web_mvc_jsp_publicteammember_category.label&quot;/&gt;<br/>            &lt;/h2&gt;<br/>            &lt;ul&gt;<br/>            &lt;li id=&quot;web_mvc_jsp_list_publicteammember_menu_item&quot;&gt;<br/>                    &lt;spring:url value=&quot;/publicteammember?page=${empty param.page ? 1 : param.page}&amp;amp;amp;size=${empty param.size ? 10 : param.size}&quot; var=&quot;web_mvc_jsp_list_publicteammember_menu_item_url&quot;/&gt;<br/>                    &lt;a href=&quot;${web_mvc_jsp_list_publicteammember_menu_item_url}&quot;&gt;<br/>                        &lt;spring:message code=&quot;label.teammembers&quot; var=&quot;label_teammembers&quot;/&gt;<br/>                        &lt;spring:message arguments=&quot;${label_teammembers}&quot; code=&quot;global.menu.list&quot;/&gt;<br/>                    &lt;/a&gt;<br/>                &lt;/li&gt;<br/>                &lt;li id=&quot;web_mvc_jsp_create_publicteammember_menu_item&quot;&gt;<br/>                    &lt;spring:url value=&quot;/publicteammember/form&quot; var=&quot;web_mvc_jsp_create_publicteammember_menu_item_url&quot;/&gt;<br/>                    &lt;a href=&quot;${web_mvc_jsp_create_publicteammember_menu_item_url}&quot;&gt;<br/>                        &lt;spring:message code=&quot;label.teammember&quot; var=&quot;label_teammember&quot;/&gt;<br/>                        &lt;spring:message arguments=&quot;${label_teammember}&quot; code=&quot;global.menu.new&quot;/&gt;<br/>                    &lt;/a&gt;<br/>                &lt;/li&gt;<br/>            &lt;/ul&gt;<br/>        &lt;/li&gt;<br/><br/>    &lt;/security:authorize&gt;<br/>    &lt;/ul&gt;<br/>&lt;/div&gt;<br/>[/sourcecode]</pre><br/>Rember to update the <strong>src/main/webapp/WEB-INF/i18n/messages.properties</strong> (and also the localised version of that file to include the text for the new global.menu.show menu item. Now when you restart your tomcat instance and log into the site as one of the authorised users without admin permissions, you will see something like this:<br/><br/><a href="http://kramkroc.files.wordpress.com/2010/08/new_roo_layout.png"><img class="aligncenter size-full wp-image-52" title="Authenticated Users View" src="http://kramkroc.files.wordpress.com/2010/08/new_roo_layout.png" alt="" width="497" height="154" /></a>